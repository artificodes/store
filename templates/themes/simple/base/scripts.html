{% load static %}
<script type="text/javascript">

  window.CSRF_TOKEN = "{{csrf_token}}";
</script>
<script src=" {% static 'base/material/assets/js/core/jquery.min.js' %} "></script>
  <script src="{% static 'base/uikit/js/uikit.min.js' %}"></script>
  <script src="{% static 'base/uikit/js/uikit-icons.min.js' %}"></script>
    <script src="{% static 'base/material/assets/js/core/popper.min.js' %}"></script>
  <!-- <script src="{% static 'base/boomerang/assets/js/theme.js' %}"></script> -->
 <!-- <script src="{% static 'base/material/assets/js/core/bootstrap-material-design.min.js' %}"></script> -->
  <script src="{% static 'base/material/assets/js/plugins/moment.min.js' %}"></script>
  <script src="{% static 'base/argon/vendor/bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'base/argon/vendor/js-cookie/js.cookie.js' %}"></script>
  <script src="{% static 'base/argon/vendor/jquery.scrollbar/jquery.scrollbar.min.js' %}"></script>
  <script src="{% static 'base/argon/vendor/jquery-scroll-lock/dist/jquery-scrollLock.min.js' %}"></script>
  <!-- Optional JS -->
  <script src="{% static 'base/countrycodes/js/intlTelInput.min.js' %}"></script>
  <script src="{% static 'base/countrycodes/js/intlTelInput-jquery.min.js' %}"></script>
  <script src="{% static 'base/argon/vendor/chart.js/dist/Chart.min.js' %}"></script>
  <script src="{% static 'base/argon/vendor/chart.js/dist/Chart.extension.js' %}"></script>
 <script src="{% static 'base/argon/js/argon.js' %}?v=1.2.0" type="text/javascript"></script>
 
  <script src="{% static 'base/material/assets/js/plugins/bootstrap-datetimepicker.min.js' %}"></script>
  <script src="{% static 'base/material/assets/js/plugins/nouislider.min.js' %}"></script>
  <!-- <script src="{% static 'base/material/assets/js/material-kit.js' %}"></script> -->
  <script src="{% static 'base/material/assets/js/buttons.js' %}"></script>
  <!-- <script src="{% static 'base/material/assets/js/material-kit.minb68f.js' %}"></script> -->
   <!-- <script src="{% static 'base/material/assets/js/material-kit.minf27d.js' %}"></script> -->
   <script src="{% static 'base/countdown/js/jQuery.countdownTimer.js' %}"></script>
   <script src="{% static 'base/formvalidation/DjValidator.js' %}"></script>

 <script src="{% static 'base/semantic/semantic.min.js' %}"></script>


  <!-- <script src="{% static 'base/custom/custom.js' %}"></script> -->
<script src="{% static 'base/girly/js/owl.carousel.min.js' %}"></script>
<script src="{% static 'base/argon/vendor/headroom/jQuery.headroom.min.js' %}"></script>
<script src="{% static 'base/argon/vendor/headroom/headroom.min.js' %}"></script>
<script src="{% static 'base/girly/js/main.js' %}"></script>

 <script src="{% static 'base/idle/jquery.idle.js' %}"></script>
 <script src="{% static 'base/visible/jquery.visible.js' %}"></script>
 <script src="{% static 'base/visibility/jquery-beacons.js' %}"></script>
  <script src="{% static 'base/inputcounter/js/handleCounter.js' %}"></script>
  <script src="{% static 'base/bootstrap/js/bootstrap-datetimepicker.js' %}"></script>
  <script src="{% static 'base/imagepreview/js/jpreview.js' %}"></script>
  <!-- <script src="{% static 'base/searchselect/js/jquery-customselect-1.9.1.js' %}"></script>-->
  <script src="{% static 'base/tinymce/jquery.tinymce.min.js' %}"></script>
  <script src="{% static 'base/tinymce/tinymce.min.js' %}"></script> 
<!-- <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js" ></script> -->
<script src="{% static 'base/lga/lga.js' %}"></script> 
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

  <!-- <script src="{% static 'base/tinymce/custom.js' %}"></script>
  <script src="{% static 'base/videothumbnails/jquery.youtubevideo.js' %}"></script>
  <script src="{% static 'base/videomodal/jquery-modal-video.js' %}"></script>
  <script src="{% static 'base/videomodal/modal-video.js' %}"></script>

  <script>

    
    $(document).ready(function() {

      if ($('.datetimepicker').length != 0) {
        materialKit.initFormExtendedDatetimepickers();
      }

      if ($('.slider').length != 0) {
        materialKit.initSliders();
      }

      //  Activate the tooltips
      $('[data-toggle="tooltip"]').tooltip();

      // Activate Popovers
      $('[data-toggle="popover"]').popover();

    });
  </script>
-->
<!-- <script src="https://checkout.flutterwave.com/v3.js"></script> -->

<script>
// var paymentForm = document.getElementById('paymentForm');

// paymentForm.addEventListener('submit', payWithPaystack, false);


function orderPaid(orderid){
  $.ajax({
            beforeSend: function () {

                showLoadingBar()
            },
            complete: function () {
                hideLoadingBar()

            },
            url: "{% url 'customer_order_paid' %}",
            type: 'post',
            data: { 'csrfmiddlewaretoken': '{{csrf_token}}',
            'orderid':orderid},

            success: function (response) {
               if(response.status == 'success'){
              if (response.modal_message) {
                    messageModal(response.modal_message,)
                }
                function callRedirect(){
                  redirect(response.url)
                }
                setTimeout(callRedirect,5000)
               
              }
                
            },

            error: function (xhr, status, error) {
                alert(status)
            }
        });


}

function payWithPaystack(email,amount,orderid) {

  var handler = PaystackPop.setup({

    key: 'pk_test_354c04fa51e80a0f95c741d21f80b5565113cdd4', // Replace with your public key

    email:email,

    amount: amount * 100, // the amount value is multiplied by 100 to convert to the lowest currency unit

    currency: 'NGN', // Use GHS for Ghana Cedis or USD for US Dollars

    ref: orderid, // Replace with a reference you generated

    callback: function(response) {

      //this happens after the payment is completed successfully

      var reference = response.reference;

      // alert('Payment complete! Reference: ' + reference);

      // Make an AJAX call to your server with the reference to verify the transaction
      $.ajax({
            beforeSend: function () {

                showLoadingBar()
            },
            complete: function () {
                hideLoadingBar()

            },
            url: "{% url 'customer_verify_payment' %}",
            type: 'post',
            data: { 'csrfmiddlewaretoken': '{{csrf_token}}',
            'reference':response.reference},

            success: function (response) {
                if (response.success) {
                   orderPaid(orderid)

                }
                
            },

            error: function (xhr, status, error) {
                alert(status)
            }
        });


    },

    onClose: function() {

      // alert('Transaction was not completed, window closed.');

    },

  });

  handler.openIframe();

}


</script>
